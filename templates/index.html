<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>頭痛日記</title>
    <style>
        :root {
            --small: #FFD966;
            --medium: #FFA500;
            --large: #FF6161;
            --cell-size: 80px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", "Microsoft JhengHei", sans-serif
        }

        body {
            margin: 18px
        }

        header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px
        }

        h1 {
            font-size: 20px;
            margin: 0
        }

        .controls {
            display: flex;
            gap: 8px;
            align-items: center
        }

        button {
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            background: #fff;
            cursor: pointer
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px
        }

        .weekday {
            font-weight: 600;
            text-align: center
        }

        .cell {
            height: var(--cell-size);
            border-radius: 8px;
            border: 1px solid #e6e6e6;
            padding: 6px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between
        }

        .date {
            font-size: 13px
        }

        .dot {
            width: 100%;
            height: 8px;
            border-radius: 6px;
            margin-top: 6px
        }

        .legend {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            align-items: center
        }

        .legend span {
            display: inline-flex;
            align-items: center;
            gap: 6px
        }

        .dotbox {
            width: 14px;
            height: 14px;
            border-radius: 3px
        }

        .modal {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.35);
        }

        .card {
            background: #fff;
            padding: 16px;
            border-radius: 10px;
            width: 520px;
            max-width: 95%;
            max-height: 90%;
            overflow: auto
        }

        .form-row {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px
        }

        label {
            min-width: 120px
        }

        input[type="number"],
        input[type="time"],
        select,
        textarea {
            flex: 1;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 6px
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px
        }

        .small {
            font-size: 13px;
            color: #666
        }

        .actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 10px
        }

        .import-export {
            margin-left: auto;
            display: flex;
            gap: 6px;
            align-items: center
        }

        .empty {
            color: #999;
            text-align: center;
            padding: 18px
        }

        .cell:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08)
        }

        .status {
            font-size: 13px;
            color: #444
        }
    </style>
</head>

<body>
    <header>
        <h1>頭痛日記</h1>
        <div class="controls">
            <button id="prev">◀</button>
            <div id="monthLabel" style="min-width:160px;text-align:center"></div>
            <button id="next">▶</button>
            <div class="import-export">
                <button id="exportBtn">匯出 JSON</button>
                <button id="importBtn">匯入 JSON</button>
                <input id="importFile" type="file" accept="application/json" style="display:none" />
                <button id="driveConnectBtn">連結 Google Drive</button>
                <button id="driveImportBtn">從 Drive 匯入</button>
                <button id="driveExportBtn">上傳到 Drive</button>
                <div id="driveStatus" class="status"></div>
            </div>
        </div>
    </header>

    <div class="calendar" id="calendar"></div>
    <div class="legend">
        <span><span class="dotbox" style="background:var(--small)"></span>小痛</span>
        <span><span class="dotbox" style="background:var(--medium)"></span>中痛</span>
        <span><span class="dotbox" style="background:var(--large)"></span>大痛</span>
        <span class="small">（未紀錄不上色，點日期可新增或檢視當日記錄）</span>
    </div>

    <template id="cellTemplate">
        <div class="cell">
            <div class="date"></div>
            <div class="dot"></div>
        </div>
    </template>

    <!-- Modal -->
    <div id="modal" style="display:none" class="modal">
        <div class="card">
            <h3 id="modalTitle">新增頭痛記錄</h3>
            <div class="form-row"><label>日期時間</label><input id="datetime" type="datetime-local"></div>

            <div class="form-row"><label>頭痛程度</label>
                <select id="severity">
                    <option value="">未選</option>
                    <option value="1">1：小痛</option>
                    <option value="2">2：中痛</option>
                    <option value="3">3：大痛</option>
                </select>
            </div>

            <div class="form-row"><label>伴隨症狀</label>
                <div style="flex:1">
                    <div class="checkbox-grid">
                        <label><input type="checkbox" value="噁心嘔吐" class="symptom"> 噁心嘔吐</label>
                        <label><input type="checkbox" value="怕光怕吵" class="symptom"> 怕光怕吵</label>
                        <label><input type="checkbox" value="單側開始" class="symptom"> 單側開始</label>
                        <label><input type="checkbox" value="搏動性頭痛" class="symptom"> 搏動性頭痛</label>
                        <label><input type="checkbox" value="因活動加劇" class="symptom"> 因活動加劇</label>
                        <label><input type="checkbox" value="其他" id="symptomOtherChk" class="symptom"> 其他</label>
                    </div>
                    <div style="margin-top:6px"><input id="symptomOtherTxt" placeholder="其他症狀備註" disabled></div>
                </div>
            </div>

            <div class="form-row"><label>持續時間（小時）</label><input id="duration" type="number" min="0" step="0.1"
                    placeholder="例如: 2.5"></div>

            <div class="form-row"><label>服用急性藥物</label>
                <div style="flex:1">
                    <label><input type="checkbox" value="止痛藥" class="med"> 止痛藥</label>
                    <label style="margin-left:12px"><input type="checkbox" value="其他" id="medOtherChk" class="med">
                        其他</label>
                    <div style="margin-top:6px"><input id="medOtherTxt" placeholder="其他藥物備註" disabled></div>
                </div>
            </div>

            <div class="form-row"><label>藥物有效</label><input id="medEffective" type="checkbox"></div>
            <div class="form-row"><label>是否影響生活</label><input id="affectLife" type="checkbox"></div>
            <div class="form-row"><label>是否生理期</label><input id="onPeriod" type="checkbox"></div>

            <div class="form-row"><label>備註</label><textarea id="notes" rows="3"></textarea></div>

            <div class="actions">
                <button id="deleteBtn" style="background:#fff">刪除</button>
                <button id="cancelBtn">取消</button>
                <button id="saveBtn">儲存</button>
            </div>
        </div>
    </div>

    <!-- Google Identity & API scripts loaded at runtime when user connects -->
    <script>
        window.APP_CONFIG = {
            GOOGLE_CLIENT_ID: "{{ google_client_id }}",
            DRIVE_FILE_ID_KEY: "{{ drive_file_id_key }}"
        };
    </script>

    <!-- 你的主要程式 -->
    <script src="/static/main.js"></script>
</body>

</html>